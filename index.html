<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>P2Pforyou — Sell USDT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark: #0d1117;
  --bg-card: #161b22;
  --accent: #00ff88;
  --accent-hover: #00cc6a;
  --text: #f5f5f5;
  --text-muted: #9da5b4;
  --radius: 10px;
  --shadow: 0 4px 20px rgba(0,0,0,0.4);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family: 'Inter', sans-serif;
  background: var(--bg-dark);
  color: var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:16px;
}
.container{
  width:100%;
  max-width:760px;
}
.panel{
  background: var(--bg-card);
  border-radius: var(--radius);
  padding:20px;
  box-shadow: var(--shadow);
}
header.top{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:16px;
  flex-wrap:wrap;
}
.logo{
  background: var(--accent);
  color:#000;
  font-weight:700;
  padding:8px 14px;
  border-radius: var(--radius);
}
h1{
  font-size:20px;
}
.lead{
  font-size:13px;
  color: var(--text-muted);
  margin-top:4px;
}

/* Payment mode */
.mode-row{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-bottom:14px;
}
.mode-row select{
  background:#222;
  color:var(--text);
  border:1px solid #333;
  padding:10px;
  border-radius: var(--radius);
  font-size:14px;
}
.caption{
  font-size:12px;
  color: var(--text-muted);
}

/* Swap card */
.swap{
  background:#1e242c;
  padding:14px;
  border-radius: var(--radius);
  display:flex;
  flex-direction:column;
  gap:14px;
  border:1px solid #2a313a;
}
.swap-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.box{
  background:#222831;
  padding:12px;
  border-radius: var(--radius);
  flex:1;
  min-width:200px;
  border:1px solid #2f363f;
}
.label{
  font-size:12px;
  color: var(--text-muted);
  margin-bottom:4px;
  display:flex;
  align-items:center;
}
.label svg{
  width:16px;
  height:16px;
  vertical-align:middle;
  margin-right:8px;
  flex-shrink:0;
}
.network-select{
  display:flex;
  align-items:center;
  border:1px solid #333;
  border-radius: var(--radius);
  background:#2b313c;
  padding:4px;
}
select,input[type="number"],input[type="text"],textarea{
  background:transparent;
  border:none;
  outline:none;
  color:var(--text);
  font-size:14px;
  width:100%;
}
.big-input{
  font-size:18px;
  font-weight:700;
  text-align:right;
}
.inr-display{
  font-size:18px;
  font-weight:700;
  text-align:right;
}
.small-caption{
  font-size:12px;
  color: var(--text-muted);
}

/* Arrow */
.arrow-wrap{
  text-align:center;
}
.arrow{
  width:40px;
  height:40px;
  border-radius:50%;
  background:#2a313a;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:default;
}
.arrow svg{
  fill:var(--accent);
}

/* Payment details */
.payment{
  padding-top:10px;
  border-top:1px solid #2a313a;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.field input, .field select{
  background:#2b313c; /* better contrast */
  border:1px solid #555; /* lighter border */
  padding:8px;
  border-radius: var(--radius);
  font-size:14px;
  color:#fff; /* brighter text */
}

/* Buttons */
.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:6px;
}
.btn{
  flex:1;
  padding:12px;
  border:none;
  font-weight:700;
  border-radius: var(--radius);
  cursor:pointer;
  font-size:14px;
}
.btn.primary{
  background: var(--accent);
  color:#000;
}
.btn.primary:hover{
  background: var(--accent-hover);
}
.btn.ghost{
  background: transparent;
  border:1px solid #333;
  color: var(--text);
}
.btn.ghost:hover{
  background:#2a313a;
}
.hint{
  font-size:12px;
  color: var(--text-muted);
}

/* Responsive */
@media(max-width:600px){
  .swap-row{flex-direction:column;}
}
</style>
</head>
<body>
<div class="container">
  <div class="panel">
    <header class="top">
      <div class="logo">P2Pforyou</div>
      <div>
        <h1>Sell USDT — Swap</h1>
        <div class="lead">Choose payment mode, enter USDT — get instant INR calculation.</div>
      </div>
    </header>

    <div class="mode-row">
      <label class="label">Payment Receiving Mode</label>
      <select id="payment_mode">
        <option value="">-- Select Payment Mode --</option>
        <option value="UPI">UPI (instant)</option>
        <option value="CDM">CDM (cash deposit)</option>
        <option value="Bank">Bank Transfer</option>
      </select>
      <div class="caption">CDM → Min 50 USDT, UPI/Bank → Min 1.2 USDT</div>
    </div>

    <div class="swap" id="swapCard">
      <div class="swap-row" style="align-items:center;">

        <!-- You Send -->
        <div class="box">
          <div class="label">
            <!-- Inline USDT-ish SVG (green circle + T bar) -->
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
              <circle cx="32" cy="32" r="30" fill="#00ff88"/>
              <!-- simplified 'T' -->
              <rect x="18" y="18" width="28" height="6" rx="3" fill="#ffffff"/>
              <rect x="30" y="24" width="4" height="24" rx="2" fill="#ffffff"/>
            </svg>
            You Send
          </div>

          <div class="small-caption" style="margin-bottom:6px;">Select Network</div>
          <div style="display:flex;justify-content:space-between;gap:8px;">
            <div class="network-select" aria-hidden="false">
              <select id="network">
                <option value="BEP20">USDT BEP20</option>
                <option value="Polygon">USDT Polygon</option>
                <option value="TRC20">USDT TRC20</option>
              </select>
            </div>
            <input id="usdt" type="number" class="big-input" step="0.01" min="1.2" max="500" placeholder="0.00" aria-label="USDT amount">
          </div>
          <div class="small-caption">Min & Max enforced.</div>
        </div>

        <!-- Swap Arrow -->
        <div class="arrow-wrap" aria-hidden="true" title="Swap">
          <div class="arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M17 1l4 4-4 4V6H3V4h14V1zm-10 22l-4-4 4-4v3h14v2H7v3z"/>
            </svg>
          </div>
        </div>

        <!-- You Receive -->
        <div class="box">
          <div class="label">
            <!-- Inline INR SVG: green circle with rupee symbol -->
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
              <circle cx="32" cy="32" r="30" fill="#ffffff"/>
              <text x="50%" y="52%" text-anchor="middle" font-family="Inter, Arial, sans-serif" font-size="28" fill="#00ff88" dy=".1em">₹</text>
            </svg>
            You Receive
          </div>
          <div id="inrDisplay" class="inr-display">—</div>
          <div id="rateDisplay" class="small-caption">Rate: —</div>
        </div>

      </div>

      <div class="payment" id="paymentSection">
        <div class="field">
          <label>Payment Details</label>
          <div class="caption">Provide details based on selected mode.</div>
        </div>
        <div id="modeFields"></div>
        <div class="hint">After submit, you'll get USDT address & instructions.</div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="previewBtn">Preview</button>
        <button class="btn primary" id="submitBtn">Submit Order</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxuTvGuI7VGakfHIXOip8yDy261HUo4ycW0FPqJNo1nVTteLAEbavONXtbAPEvKbXWE/exec';

  function getRate(amount){
    if(amount >= 1.2 && amount <= 10) return 83.5;
    if(amount > 10 && amount <= 30.99) return 84;
    if(amount > 30.99 && amount <= 100.99) return 85.2;
    if(amount > 100.99 && amount <= 380.9) return 86;
    if(amount > 380.9 && amount <= 500) return 86.6;
    return 0;
  }
  function fmt(n){ return Number(n).toFixed(2); }

  let paymentModeEl, networkEl, usdtEl, inrEl, rateEl, modeFields, previewBtn, submitBtn;
  let submitting = false;

  function renderModeFields(){
    const mode = paymentModeEl.value;
    modeFields.innerHTML = '';
    if(mode === 'UPI'){
      modeFields.innerHTML = `
        <div class="field"><input id="upi_id" placeholder="UPI ID (example@bank)"></div>
        <div class="field"><input id="scanner" type="file" accept="image/png"></div>
      `;
    } else if(mode === 'CDM'){
      modeFields.innerHTML = `
        <div class="field"><input id="cdm_account_number" placeholder="Account number"></div>
        <div class="field"><input id="cdm_bank_name" placeholder="Bank name"></div>
        <div class="field"><input id="cdm_holder_name" placeholder="Account holder name"></div>
      `;
    } else if(mode === 'Bank'){
      modeFields.innerHTML = `
        <div class="field">
          <select id="bank_name_select">
            <option value="">--Select bank--</option>
            <option>HDFC Bank</option>
            <option>ICICI Bank</option>
            <option>SBI</option>
            <option>Axis Bank</option>
          </select>
        </div>
        <div class="field"><input id="bank_account_number" placeholder="Account number"></div>
        <div class="field"><input id="bank_holder_name" placeholder="Account holder"></div>
        <div class="field"><input id="ifsc_code" placeholder="IFSC"></div>
      `;
    }
  }

  function applyMinForMode(){
    const mode = paymentModeEl.value;
    const min = (mode === 'CDM') ? 50 : 1.2;
    usdtEl.min = min;
    if(!usdtEl.value || parseFloat(usdtEl.value) < min){
      usdtEl.value = min;
    }
    updateINR();
  }

  function updateINR(){
    const raw = parseFloat(usdtEl.value);
    if(isNaN(raw)){
      rateEl.textContent = 'Rate: —';
      inrEl.textContent = '—';
      return;
    }
    let v = raw;
    if(v > 500){
      v = 500;
      usdtEl.value = 500;
      alert('Maximum 500 USDT');
    }
    const min = parseFloat(usdtEl.min || 1.2);
    if(v < min){
      rateEl.textContent = `Min ${min} USDT`;
      inrEl.textContent = '—';
      return;
    }
    const rate = getRate(v);
    if(!rate){
      rateEl.textContent = 'Rate: —';
      inrEl.textContent = '—';
      return;
    }
    inrEl.textContent = `₹${fmt(v * rate)}`;
    rateEl.textContent = `Rate: ₹${rate.toFixed(2)}`;
  }

  function previewOrder(){
    const mode = paymentModeEl.value;
    const net = networkEl.value;
    const amt = parseFloat(usdtEl.value);
    if(!mode) return alert('Select payment mode');
    if(isNaN(amt)) return alert('Enter USDT amount');
    const rate = getRate(amt);
    if(!rate) return alert('Invalid amount');
    if(confirm(`Preview:\n${amt} USDT on ${net}\nReceive ₹${fmt(amt*rate)}\nMode: ${mode}`)){
      submitOrder();
    }
  }

  async function submitOrder(){
    if(submitting) return;
    submitting = true;
    submitBtn.disabled = true;
    previewBtn.disabled = true;

    const mode = paymentModeEl.value;
    const net = networkEl.value;
    const amt = parseFloat(usdtEl.value);
    if(!mode) { alert('Select payment mode'); resetSubmit(); return; }
    if(isNaN(amt)) { alert('Enter USDT amount'); resetSubmit(); return; }

    const fd = new FormData();
    fd.append('payment_mode', mode);
    fd.append('network', net);
    fd.append('usdt_amount', amt.toFixed(2));
    fd.append('client_ts', new Date().toISOString());

    if(mode === 'UPI'){
      fd.append('upi_id', document.getElementById('upi_id').value.trim());
      fd.append('scanner', document.getElementById('scanner').files[0]);
    } else if(mode === 'CDM'){
      fd.append('cdm_account_number', document.getElementById('cdm_account_number').value.trim());
      fd.append('cdm_bank_name', document.getElementById('cdm_bank_name').value.trim());
      fd.append('cdm_holder_name', document.getElementById('cdm_holder_name').value.trim());
    } else if(mode === 'Bank'){
      fd.append('bank_name_select', document.getElementById('bank_name_select').value);
      fd.append('bank_account_number', document.getElementById('bank_account_number').value.trim());
      fd.append('bank_holder_name', document.getElementById('bank_holder_name').value.trim());
      fd.append('ifsc_code', document.getElementById('ifsc_code').value.trim());
    }

    try{
      const res = await fetch(scriptURL, { method: 'POST', body: fd });
      const txt = await res.text();
      const orderId = txt.trim();
      if(orderId){
        window.location.href = `waiting.html?order_id=${encodeURIComponent(orderId)}`;
      } else {
        alert('No Order ID received');
        resetSubmit();
      }
    }catch(err){
      alert('Submit failed');
      resetSubmit();
    }
  }

  function resetSubmit(){
    submitting = false;
    submitBtn.disabled = false;
    previewBtn.disabled = false;
  }

  function init(){
    paymentModeEl = document.getElementById('payment_mode');
    networkEl = document.getElementById('network');
    usdtEl = document.getElementById('usdt');
    inrEl = document.getElementById('inrDisplay');
    rateEl = document.getElementById('rateDisplay');
    modeFields = document.getElementById('modeFields');
    previewBtn = document.getElementById('previewBtn');
    submitBtn = document.getElementById('submitBtn');

    renderModeFields();
    usdtEl.value = 1.2;
    updateINR();

    paymentModeEl.addEventListener('change', ()=>{ renderModeFields(); applyMinForMode(); });
    networkEl.addEventListener('change', updateINR);
    usdtEl.addEventListener('input', updateINR);
    previewBtn.addEventListener('click', previewOrder);
    submitBtn.addEventListener('click', submitOrder);
  }
  document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>
