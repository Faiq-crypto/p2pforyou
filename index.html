<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>P2Pforyou — Swap Sell USDT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  /* ---------- Theme variables ---------- */
  :root{
    --bg-1:#041025; --bg-2:#071227;
    --card:#071720; --glass: rgba(255,255,255,0.03);
    --accent:#00ff88; --accent-2:#00cc66; --accent-3:#00e6a3;
    --muted:#98a3b3;
    --radius:16px; --shadow: 0 16px 50px rgba(2,8,23,0.7);

    /* extra */
    --border-grad: conic-gradient(from 0deg, #00f5ff, #7b61ff, #ff4da6, #00ff88, #00f5ff);
    --glass-strong: rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    color:#e6fff2; display:flex;align-items:center;justify-content:center;padding:22px;
    /* layered animated background */
    background:
      radial-gradient(1000px 400px at 10% 12%, rgba(0,255,136,0.03), transparent 6%),
      linear-gradient(135deg,var(--bg-1),var(--bg-2));
    overflow:hidden;
    -webkit-font-smoothing:antialiased;
    position:relative;
  }

  /* neon blurred decorative waves (under content) */
  .neon-wave{
    position: absolute;
    inset: -10% -20%;
    background:
      radial-gradient(circle at 12% 18%, rgba(0,255,136,0.06), transparent 12%),
      radial-gradient(circle at 88% 85%, rgba(0,170,255,0.04), transparent 12%),
      radial-gradient(circle at 78% 20%, rgba(255,80,200,0.03), transparent 8%);
    filter: blur(40px) saturate(130%);
    mix-blend-mode: screen;
    pointer-events: none;
    animation: waveRotate 18s linear infinite;
    z-index:0;
  }
  @keyframes waveRotate { 0%{transform:rotate(0)} 50%{transform:rotate(180deg)} 100%{transform:rotate(360deg)} }

  /* animated subtle starfield dots */
  .dust {
    pointer-events:none;
    position:absolute;
    inset:0;
    background-image:
      radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
      radial-gradient(rgba(255,255,255,0.015) 1px, transparent 1px);
    background-size: 120px 120px, 200px 200px;
    opacity:0.7;
    mix-blend-mode:overlay;
    transform: translateZ(0);
    z-index:0;
    animation: drift 40s linear infinite;
  }
  @keyframes drift { from { transform:translateY(0)} to{ transform:translateY(-40px)} }

  /* container + animated gradient border */
  .container{width:100%;max-width:820px;padding:12px;position:relative;z-index:2}
  .border-anim{
    border-radius:20px;
    padding:3px; /* outer band */
    background: var(--border-grad);
    background-size: 200% 200%;
    animation: borderShift 6s linear infinite;
    box-shadow: 0 8px 40px rgba(0,0,0,0.35);
  }
  @keyframes borderShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

  /* inner panel (glass) */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:17px;padding:18px;border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 18px 60px rgba(2,8,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    backdrop-filter: blur(10px) saturate(120%);
    overflow:hidden;
    position:relative;
    transition:transform .28s cubic-bezier(.2,.9,.2,1);
  }

  header.top{display:flex;align-items:center;gap:14px;margin-bottom:14px;flex-wrap:wrap}
  .logo{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    padding:8px 12px;border-radius:10px;color:#001;font-weight:900;
    box-shadow: 0 6px 20px rgba(0,255,136,0.06);
    letter-spacing:0.6px;
  }
  h1{font-size:18px;margin:0}
  .lead{color:var(--muted);font-size:13px;margin-top:6px}

  /* Payment mode selector */
  .mode-row{display:flex;flex-direction:column;gap:8px;margin:6px 0 12px}
  .caption{color:var(--muted);font-size:13px}

  /* Swap card */
  .swap{
    margin-top:8px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);
    display:flex;flex-direction:column;gap:10px;transition:transform .28s cubic-bezier(.2,.9,.2,1);
    position:relative;
    overflow:visible;
  }
  .swap::after{
    content:''; position:absolute; inset:auto 8% -40px 8%; height:120px; border-radius:50px;
    background: linear-gradient(90deg, rgba(0,255,136,0.02), rgba(0,200,255,0.01));
    filter: blur(32px);
    pointer-events:none;
  }

  .swap-row{display:flex;gap:12px;align-items:center}
  .box{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03));
    padding:14px;border-radius:12px;flex:1;border:1px solid rgba(255,255,255,0.03);
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .box:active{transform:translateY(1px)}
  .box:hover{box-shadow: 0 10px 30px rgba(0,0,0,0.45)}
  .label{font-size:12px;color:var(--muted);margin-bottom:6px}
  .float-row{display:flex;gap:8px;align-items:center}
  .network-select{
    display:flex;gap:8px;align-items:center;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);
    box-shadow: 0 6px 18px rgba(0,0,0,0.35) inset;
  }
  select,input[type="number"],input[type="text"],textarea{
    background:transparent;border:none;color:inherit;font-size:15px;outline:none;padding:6px;width:100%;
    -webkit-appearance:none; -moz-appearance:none; appearance:none;
  }
  input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

  .big-input{font-size:20px;font-weight:700;text-align:right}
  .inr-display{font-size:18px;font-weight:700;text-align:right; color: #e6ffe8; text-shadow: 0 2px 18px rgba(0,255,136,0.08)}

  /* arrow */
  .arrow-wrap{display:flex;align-items:center;justify-content:center;margin:6px 0}
  .arrow{
    width:52px;height:52px;border-radius:50%;background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.02);
    transform:translateY(0);transition:transform .18s ease, box-shadow .18s ease;
    box-shadow: 0 8px 30px rgba(0,0,0,0.35);
  }
  .arrow:hover{transform:translateY(-8px);box-shadow:0 28px 68px rgba(0,0,0,0.6)}
  .arrow svg{fill:var(--accent)}

  .rate-line{text-align:center;color:var(--muted);font-size:13px;margin-top:6px}

  /* Payment details */
  .payment{margin-top:14px;padding-top:12px;border-top:1px dashed rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px}
  .field{display:flex;flex-direction:column;gap:6px}
  .small-caption{font-size:12px;color:var(--muted)}
  label{font-size:13px;color:var(--muted);margin-bottom:6px}

  /* actions */
  .actions{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}
  .btn{flex:1;padding:12px;border-radius:12px;border:none;cursor:pointer;font-weight:800;letter-spacing:0.6px}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-3));color:#001;box-shadow:0 8px 30px rgba(0,255,136,0.06)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:#fff}

  .hint{font-size:12px;color:var(--muted)}
  .muted{color:var(--muted)}

  /* animated highlight for INR */
  .inr-anim{
    animation: pulse .42s ease;
  }
  @keyframes pulse{
    0%{ transform: scale(0.98); opacity:0.9 }
    60%{ transform: scale(1.02); opacity:1 }
    100%{ transform: scale(1); opacity:1 }
  }

  /* small floating accent for logo */
  .logo:after{
    content:'';
    display:block;
    width:8px;height:8px;border-radius:50%;
    background:radial-gradient(circle,#ffffff, #00ff88 60%);
    opacity:0.08;
    margin-top:6px;
  }

  /* subtle entry animations */
  .panel, .swap, .box { animation: floatIn .28s ease both; }
  @keyframes floatIn{from{transform:translateY(8px);opacity:0}to{transform:none;opacity:1}}

  /* responsive */
  @media (max-width:820px){
    .swap-row{flex-direction:column}
    .arrow-wrap{display:none}
    .container{padding:6px}
    .panel{padding:12px;border-radius:14px}
    .big-input{font-size:18px}
  }

  /* ensure overlays are behind UI */
  .neon-wave, .dust { z-index: 0; }
  .container, .container * { z-index: 2; position: relative; }
</style>
</head>
<body>
  <!-- decorative layers -->
  <div class="neon-wave" aria-hidden="true"></div>
  <div class="dust" aria-hidden="true"></div>

  <div class="container">
    <!-- animated gradient border -->
    <div class="border-anim">
      <div class="panel" role="main" aria-labelledby="pageTitle">
        <header class="top">
          <div class="logo">P2Pforyou</div>
          <div>
            <h1 id="pageTitle">Sell USDT — Swap style</h1>
            <div class="lead">Fast P2P order. Choose payment mode, pick network, enter USDT — INR updates instantly.</div>
          </div>
        </header>

        <!-- Payment mode selector (top) -->
        <div class="mode-row">
          <label class="label">Payment Receiving Mode <span class="hint">(select first)</span></label>
          <select id="payment_mode" aria-label="Payment mode">
            <option value="">-- Select Payment Mode --</option>
            <option value="UPI">UPI (instant)</option>
            <option value="CDM">CDM (cash deposit)</option>
            <option value="Bank">Bank Transfer</option>
          </select>
          <div class="caption">Selecting a mode sets the minimum amount: <strong>CDM → 50 USDT</strong>, <strong>UPI/Bank → 1.2 USDT</strong>.</div>
        </div>

        <!-- Swap Card -->
        <div class="swap" id="swapCard" role="region" aria-label="Swap card">
          <div class="swap-row">
            <div class="box" id="sendBox">
              <div class="label">You Send</div>
              <div class="float-row" style="justify-content:space-between;">
                <div style="display:flex;gap:8px;align-items:center;">
                  <div class="network-select" title="Choose network">
                    <select id="network" aria-label="Network">
                      <option value="BEP20">USDT BEP20</option>
                      <option value="Polygon">USDT Polygon</option>
                      <option value="TRC20">USDT TRC20</option>
                    </select>
                  </div>
                </div>
                <div style="flex:1;display:flex;justify-content:flex-end;">
                  <input id="usdt" class="big-input" type="number" inputmode="decimal" step="0.01" min="1.2" max="500" placeholder="0.00" aria-label="USDT amount">
                </div>
              </div>
              <div class="small-caption muted">Min & Max enforced. Type amount to update INR instantly.</div>
            </div>

            <div class="box" id="receiveBox" style="min-width:160px;">
              <div class="label">You Receive</div>
              <div id="inrDisplay" class="inr-display">—</div>
              <div class="small-caption muted" id="rateDisplay">Rate: —</div>
            </div>
          </div>

          <div class="arrow-wrap" title="Swap arrow (visual)">
            <div class="arrow" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 16l-6-6h12z"/></svg>
            </div>
          </div>

          <div class="rate-line muted">Rates shown are per-range and applied by amount range. Exact INR updates live as you type.</div>

          <!-- Payment details (fields shown based on payment mode) -->
          <div class="payment" id="paymentSection">
            <div class="field">
              <div class="label">Payment Details</div>
              <div class="caption">Provide details required for the selected receiving mode (UPI/CDM/Bank).</div>
            </div>

            <div id="modeFields"></div>

            <div class="hint muted">After you submit, you'll be redirected to the waiting page where we will show the USDT address and next steps.</div>
          </div>

          <!-- Actions -->
          <div class="actions">
            <button class="btn ghost" id="previewBtn" type="button">Preview</button>
            <button class="btn primary" id="submitBtn" type="button">Submit Order</button>
          </div>
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:13px">Support • Live chat (coming soon)</div>
      </div><!-- /.panel -->
    </div><!-- /.border-anim -->
  </div><!-- /.container -->

<script>
/* -------------- CONFIG -------------- */
/* Your Apps Script endpoint */
const scriptURL = 'https://script.google.com/macros/s/AKfycbxuTvGuI7VGakfHIXOip8yDy261HUo4ycW0FPqJNo1nVTteLAEbavONXtbAPEvKbXWE/exec';

/* Rate function (per your ranges) */
function getRate(amount){
  if(amount >= 1.2 && amount <= 10) return 83.5;
  if(amount > 10 && amount <= 30.99) return 84;
  if(amount > 30.99 && amount <= 100.99) return 85.2;
  if(amount > 100.99 && amount <= 380.9) return 86;
  if(amount > 380.9 && amount <= 500) return 86.6;
  return 0;
}

/* DOM */
const paymentModeEl = document.getElementById('payment_mode');
const networkEl = document.getElementById('network');
const usdtEl = document.getElementById('usdt');
const inrEl = document.getElementById('inrDisplay');
const rateEl = document.getElementById('rateDisplay');
const modeFields = document.getElementById('modeFields');
const previewBtn = document.getElementById('previewBtn');
const submitBtn = document.getElementById('submitBtn');

/* helper: format INR */
function fmt(n){ return Number(n).toFixed(2); }

/* render payment-specific fields */
function renderModeFields(){
  const mode = paymentModeEl.value;
  modeFields.innerHTML = '';
  if(mode === 'UPI'){
    modeFields.innerHTML = `
      <div class="field">
        <label class="label">UPI ID</label>
        <input id="upi_id" placeholder="example@bank" />
        <div class="small-caption muted">Upload scanner (PNG). We'll attach this to your order for verification.</div>
        <input id="scanner" type="file" accept="image/png" />
      </div>
    `;
  } else if(mode === 'CDM'){
    modeFields.innerHTML = `
      <div class="field">
        <label class="label">Account Number</label>
        <input id="cdm_account_number" placeholder="Account number" />
      </div>
      <div class="field">
        <label class="label">Bank Name</label>
        <input id="cdm_bank_name" placeholder="Bank name" />
      </div>
      <div class="field">
        <label class="label">Account Holder</label>
        <input id="cdm_holder_name" placeholder="Holder name" />
      </div>
    `;
  } else if(mode === 'Bank'){
    modeFields.innerHTML = `
      <div class="field">
        <label class="label">Bank</label>
        <select id="bank_name_select">
          <option value="">--Select bank--</option>
          <option>HDFC Bank</option>
          <option>ICICI Bank</option>
          <option>SBI</option>
          <option>Axis Bank</option>
        </select>
      </div>
      <div class="field">
        <label class="label">Account Number</label>
        <input id="bank_account_number" placeholder="Account number" />
      </div>
      <div class="field">
        <label class="label">Account Holder</label>
        <input id="bank_holder_name" placeholder="Holder name" />
      </div>
      <div class="field">
        <label class="label">IFSC</label>
        <input id="ifsc_code" placeholder="IFSC code" />
      </div>
    `;
  } else {
    modeFields.innerHTML = `<div class="hint muted">Choose a payment mode to show the required fields.</div>`;
  }
}

/* enforce minimums & set default value */
function applyMinForMode(){
  const mode = paymentModeEl.value;
  if(mode === 'CDM'){
    usdtEl.min = 50;
    if(!usdtEl.value || parseFloat(usdtEl.value) < 50) usdtEl.value = 50;
  } else {
    usdtEl.min = 1.2;
    if(!usdtEl.value || parseFloat(usdtEl.value) < 1.2) usdtEl.value = 1.2;
  }
  updateINR();
}

/* live INR update */
function updateINR(){
  const raw = parseFloat(usdtEl.value);
  if(isNaN(raw)){
    rateEl.textContent = 'Rate: —';
    inrEl.textContent = '—';
    return;
  }
  let v = raw;
  if(v > 500){ v = 500; usdtEl.value = 500; alert('Maximum allowed is 500 USDT'); }
  const min = parseFloat(usdtEl.min || 1.2);
  if(v < min){
    rateEl.textContent = `Min ${min} USDT required`;
    inrEl.textContent = '—';
    return;
  }
  const rate = getRate(v);
  if(rate === 0){ rateEl.textContent = 'Rate: —'; inrEl.textContent = '—'; return; }
  const inr = v * rate;
  rateEl.textContent = `Rate: ₹${rate.toFixed(2)}`
  inrEl.textContent = `₹${fmt(inr)}`;
  // visual pulse
  inrEl.classList.remove('inr-anim'); void inrEl.offsetWidth; inrEl.classList.add('inr-anim');
}

/* Preview */
function previewOrder(){
  const mode = paymentModeEl.value;
  const net = networkEl.value;
  const amt = parseFloat(usdtEl.value);
  if(!mode) return alert('Select payment mode first');
  if(isNaN(amt)) return alert('Enter USDT amount');
  const min = parseFloat(usdtEl.min || 1.2);
  if(amt < min) return alert(`Minimum for ${mode} is ${min} USDT`);
  const rate = getRate(amt), inr = (amt * rate).toFixed(2);
  const summary = `Preview order:\n\nNetwork: ${net}\nAmount: ${amt} USDT\nYou will receive: ₹${inr}\nMode: ${mode}\n\nProceed to submit?`;
  if(confirm(summary)) submitOrder();
}

/* Submit flow - builds FormData and POSTs to Apps Script */
let submitting = false;
async function submitOrder(){
  if(submitting) return;
  const mode = paymentModeEl.value;
  const net = networkEl.value;
  const amt = parseFloat(usdtEl.value);
  if(!mode) return alert('Select payment mode first');
  if(isNaN(amt)) return alert('Enter USDT amount');
  const min = parseFloat(usdtEl.min || 1.2);
  if(amt < min) return alert(`Minimum for ${mode} is ${min} USDT`);
  if(amt > 500) return alert('Maximum is 500 USDT');

  // validate fields per mode
  if(mode === 'UPI'){
    const upiEl = document.getElementById('upi_id');
    const scannerEl = document.getElementById('scanner');
    if(!upiEl || !upiEl.value.trim()) return alert('Enter UPI ID');
    if(!scannerEl || !scannerEl.files.length) return alert('Upload scanner PNG for UPI');
    const f = scannerEl.files[0];
    const okType = (f.type === 'image/png' || f.name.toLowerCase().endsWith('.png'));
    if(!okType) return alert('Scanner file must be a PNG image');
  } else if(mode === 'CDM'){
    const a = document.getElementById('cdm_account_number');
    const b = document.getElementById('cdm_bank_name');
    const c = document.getElementById('cdm_holder_name');
    if(!a || !a.value.trim()) return alert('Enter CDM account number');
    if(!b || !b.value.trim()) return alert('Enter bank name');
    if(!c || !c.value.trim()) return alert('Enter account holder name');
  } else if(mode === 'Bank'){
    const bank = document.getElementById('bank_name_select');
    const acct = document.getElementById('bank_account_number');
    const holder = document.getElementById('bank_holder_name');
    const ifsc = document.getElementById('ifsc_code');
    if(!bank || !bank.value) return alert('Select bank');
    if(!acct || !acct.value.trim()) return alert('Enter account number');
    if(!holder || !holder.value.trim()) return alert('Enter account holder');
    if(!ifsc || !ifsc.value.trim()) return alert('Enter IFSC');
  }

  // build FormData
  const fd = new FormData();
  fd.append('payment_mode', mode);
  fd.append('network', net);
  fd.append('usdt_amount', amt.toFixed(2));
  // We intentionally do NOT append usdt_address here — address will be provided on the waiting page.
  fd.append('client_ts', new Date().toISOString());

  // include mode-specific fields
  if(mode === 'UPI'){
    fd.append('upi_id', document.getElementById('upi_id').value.trim());
    const scannerEl = document.getElementById('scanner');
    if(scannerEl && scannerEl.files.length) fd.append('scanner', scannerEl.files[0], scannerEl.files[0].n
