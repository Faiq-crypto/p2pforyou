<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>P2Pforyou â€” Sell USDT</title>
  <meta name="description" content="Sell USDT â€” fast P2P orders. Select network, payment mode and submit order to merchant." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#060914; --bg2:#071427; --panel:#0e1620; --muted:#98a3b3; --accent:#00ff88; --accent-2:#00cc66; --glass:rgba(255,255,255,0.02);
      --radius:14px; --shadow:0 10px 40px rgba(2,8,23,0.6); font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:#eaf6f1; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; padding:18px;
      display:flex;align-items:center;justify-content:center;
      background-image: radial-gradient(circle at 10% 10%, rgba(0,255,136,0.03), transparent 6%), radial-gradient(circle at 90% 95%, rgba(255,255,255,0.02), transparent 12%);
    }.app{width:100%;max-width:520px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}

header{display:flex;gap:12px;align-items:center}
.brand{background:linear-gradient(90deg,var(--accent),#33ffd4);color:#001;font-weight:700;padding:8px 12px;border-radius:10px}
h1{font-size:18px;margin:0}
p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

.rates{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rate{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
.rate strong{color:var(--accent)}

form{margin-top:16px;display:grid;gap:10px}
label{font-size:13px;color:var(--muted)}
select,input,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--panel);color:inherit;font-size:14px;outline:none}

.row{display:flex;gap:10px}
.half{flex:1}

.address-box{display:flex;gap:8px;align-items:center}
.address-box input{flex:1;font-family:monospace}
.copy-btn{padding:10px 12px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);cursor:pointer}

.helper{font-size:13px;color:var(--muted)}
.amount-info{display:flex;justify-content:space-between;align-items:center;gap:10px}
.rate-display{font-weight:700;color:var(--accent)}

.file-note{font-size:12px;color:var(--muted)}

.actions{display:flex;gap:10px;margin-top:8px}
.btn{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001;border:none;font-weight:700}

.small{font-size:12px;color:var(--muted)}

.watermark{position:fixed;right:18px;bottom:18px;opacity:0.06;font-weight:900;font-size:120px;transform:rotate(-12deg);pointer-events:none}

/* subtle micro interactions */
button:active{transform:translateY(1px)}
.fadeIn{animation:fadeIn .22s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* responsive */
@media (max-width:520px){ .rates{grid-template-columns:1fr} .watermark{display:none} .brand{padding:6px 10px} }

  </style>
</head>
<body>
  <div class="app">
    <div class="card fadeIn" role="main">
      <header>
        <div class="brand">P2Pforyou</div>
        <div>
          <h1>Sell USDT</h1>
          <p class="lead">Fast P2P orders â€” choose network, payment mode and submit. No admin details shown on frontend.</p>
        </div>
      </header><div class="rates">
    <div class="rate">1.2 â€“ 10 USDT: <strong>â‚¹83.5</strong></div>
    <div class="rate">10 â€“ 30.99 USDT: <strong>â‚¹84</strong></div>
    <div class="rate">30.99 â€“ 100.99 USDT: <strong>â‚¹85.2</strong></div>
    <div class="rate">100.99 â€“ 380.9 USDT: <strong>â‚¹86</strong></div>
    <div class="rate">380.9 â€“ 500 USDT: <strong>â‚¹86.6</strong></div>
  </div>

  <form id="orderForm" class="fadeIn" enctype="multipart/form-data" autocomplete="off">
    <label for="network">USDT Network</label>
    <select id="network" name="network" required>
      <option value="BEP20">USDT BEP20</option>
      <option value="Polygon">USDT Polygon</option>
      <option value="TRC20">USDT TRC20</option>
    </select>

    <label for="usdt">USDT Amount (min 1.2, max 500)</label>
    <input id="usdt" name="usdt_amount" type="number" inputmode="decimal" min="1.2" max="500" step="0.01" placeholder="e.g. 50" required />

    <div class="amount-info">
      <div class="small helper">Rate: <span id="rateDisplay">â€”</span></div>
      <div class="small helper">You get: <span id="inrDisplay">â€”</span></div>
    </div>

    <label>Send USDT to</label>
    <div class="address-box">
      <input id="usdt_address" name="usdt_address" type="text" readonly value="0x1A63d865D881E15D4103a5c031a67C0d63e9849C" />
      <button type="button" class="copy-btn" id="copyAddressBtn">ðŸ“‹ Copy</button>
    </div>
    <div class="file-note">Address changes based on network selected.</div>

    <label for="payment_mode">Payment Receiving Mode</label>
    <select id="payment_mode" name="payment_mode" required>
      <option value="">-- Select Payment Mode --</option>
      <option value="UPI">UPI</option>
      <option value="CDM">CDM</option>
      <option value="Bank">Bank Transfer</option>
    </select>

    <!-- conditional blocks -->
    <div id="modeFields"></div>

    <div class="actions">
      <button type="button" class="btn" id="previewBtn">Preview</button>
      <button type="submit" class="btn primary" id="submitBtn">Submit Order</button>
    </div>

    <div class="small" style="margin-top:10px">Minimum order: <strong>1.2 USDT</strong>. Maximum: <strong>500 USDT</strong>.</div>
  </form>

  <div class="small" style="margin-top:12px;color:var(--muted)">Support â€¢ Live chat (coming soon)</div>
</div>

  </div>  <div class="watermark">P2Pforyou</div>  <script>
    // Backend endpoint (keep unchanged)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxuTvGuI7VGakfHIXOip8yDy261HUo4ycW0FPqJNo1nVTteLAEbavONXtbAPEvKbXWE/exec';

    const networkEl = document.getElementById('network');
    const usdtEl = document.getElementById('usdt');
    const rateEl = document.getElementById('rateDisplay');
    const inrEl = document.getElementById('inrDisplay');
    const addressEl = document.getElementById('usdt_address');
    const paymentModeEl = document.getElementById('payment_mode');
    const modeFields = document.getElementById('modeFields');
    const copyBtn = document.getElementById('copyAddressBtn');
    const submitBtn = document.getElementById('submitBtn');
    const previewBtn = document.getElementById('previewBtn');
    const form = document.getElementById('orderForm');

    // Network -> address mapping
    const addresses = {
      BEP20: '0x1A63d865D881E15D4103a5c031a67C0d63e9849C',
      Polygon: '0x1A63d865D881E15D4103a5c031a67C0d63e9849C',
      TRC20: 'TUYMmZN5oTfyjDZ8zqbqsfepdbvBgoBDz3'
    };

    // rates based on ranges (kept consistent with your provided values)
    function getRate(amount){
      if(amount >= 1.2 && amount <= 10) return 83.5;
      if(amount > 10 && amount <= 30.99) return 84;
      if(amount > 30.99 && amount <= 100.99) return 85.2;
      if(amount > 100.99 && amount <= 380.9) return 86;
      if(amount > 380.9 && amount <= 500) return 86.6;
      return 0;
    }

    function updateAddress(){ addressEl.value = addresses[networkEl.value] || addresses.BEP20; }
    networkEl.addEventListener('change', updateAddress);
    updateAddress();

    // copy address with fallback
    copyBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(addressEl.value);
        copyBtn.textContent = 'Copied'; setTimeout(()=>copyBtn.textContent='ðŸ“‹ Copy', 1200);
      }catch(e){
        addressEl.select(); document.execCommand('copy'); copyBtn.textContent='Copied'; setTimeout(()=>copyBtn.textContent='ðŸ“‹ Copy', 1200);
      }
    });

    // show conditional fields depending on payment mode
    paymentModeEl.addEventListener('change', renderModeFields);
    function renderModeFields(){
      const mode = paymentModeEl.value;
      modeFields.innerHTML = '';
      if(mode === 'UPI'){
        modeFields.innerHTML = `
          <label>UPI ID</label>
          <input name="upi_id" placeholder="yourupi@bank" />
          <label>Upload Scanner (PNG only)</label>
          <input name="scanner" type="file" accept="image/png" />
          <div class="file-note">PNG only. Max 3MB recommended.</div>
        `;
      } else if(mode === 'CDM'){
        modeFields.innerHTML = `
          <label>Account Number</label>
          <input name="cdm_account_number" />
          <label>Bank Name</label>
          <input name="cdm_bank_name" />
          <label>Account Holder</label>
          <input name="cdm_holder_name" />
        `;
      } else if(mode === 'Bank'){
        modeFields.innerHTML = `
          <label>Account Number</label>
          <input name="bank_account_number" />
          <label>Bank Name</label>
          <input name="bank_name" />
          <label>Account Holder</label>
          <input name="bank_holder_name" />
          <label>IFSC</label>
          <input name="ifsc_code" />
        `;
      }
    }

    // update rate & INR display
    usdtEl.addEventListener('input', ()=>{
      let v = parseFloat(usdtEl.value);
      if(isNaN(v)) { rateEl.textContent = 'â€”'; inrEl.textContent = 'â€”'; return; }
      if(v > 500){ v = 500; usdtEl.value = 500; alert('Maximum allowed is 500 USDT'); }
      if(v < 1.2){ rateEl.textContent='Please enter at least 1.2 USDT'; inrEl.textContent='â€”'; return; }
      const rate = getRate(v);
      if(rate === 0){ rateEl.textContent='Invalid amount'; inrEl.textContent='â€”'; }
      else{ rateEl.textContent = 'â‚¹' + rate.toFixed(2); inrEl.textContent = 'â‚¹' + (v * rate).toFixed(2); }
    });

    // Preview button shows a simple confirmation modal (native) â€” using confirm for simplicity
    previewBtn.addEventListener('click', ()=>{
      const amount = usdtEl.value; const net = networkEl.value; const addr = addressEl.value; const mode = paymentModeEl.value;
      if(!amount || !mode) return alert('Enter amount and select payment mode to preview.');
      const rate = getRate(parseFloat(amount)) || 0; const inr = (parseFloat(amount) * rate).toFixed(2);
      const msg = `Confirm order:\nNetwork: ${net}\nAmount: ${amount} USDT\nYou will receive: â‚¹${inr}\nSend to: ${addr}`;
      if(confirm(msg)) form.requestSubmit();
    });

    // form submit
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      // validate scanner png if visible
      const mode = paymentModeEl.value;
      const scannerInput = form.querySelector('input[name="scanner"]');
      if(scannerInput && scannerInput.files.length){
        const f = scannerInput.files[0];
        if(f.type !== 'image/png' && !f.name.toLowerCase().endsWith('.png')){ alert('Scanner file must be a PNG image'); return; }
        if(f.size > 3 * 1024 * 1024){ if(!confirm('File is larger than 3MB, continue?')) return; }
      }

      const submitBtnText = submitBtn.textContent;
      submitBtn.disabled = true; submitBtn.textContent = 'Submitting...';

      try{
        const fd = new FormData(form);
        // include a friendly timestamp
        fd.append('client_ts', new Date().toISOString());
        const res = await fetch(scriptURL, { method:'POST', body: fd });
        const txt = await res.text();
        // Apps Script often returns plain text order id or HTML â€” try to extract an id-like token
        let orderId = null;
        try{ // if JSON
          const j = JSON.parse(txt);
          orderId = j.orderId || j.order_id || j.id || j.OrderID || null;
        }catch(_){}
        if(!orderId){
          // fallback: extract first long alphanumeric substring
          const m = txt.match(/[A-Za-z0-9_-]{6,}/);
          if(m) orderId = m[0];
        }
        if(!orderId){
          // If server returned some simple text, use it directly
          const cleaned = txt.trim();
          if(cleaned && cleaned.length < 200) orderId = cleaned;
        }

        if(orderId){
          // redirect to waiting page (keeps same backend behavior)
          window.location.href = `waiting.html?orderId=${encodeURIComponent(orderId)}`;
        } else {
          alert('Order created but we could not detect the returned Order ID. Response: ' + (txt.substring(0,200)));
          submitBtn.disabled = false; submitBtn.textContent = submitBtnText;
        }
      }catch(err){
        console.error('Submit failed',err);
        alert('Submission failed â€” please try again.');
        submitBtn.disabled = false; submitBtn.textContent = submitBtnText;
      }
    });

    // small UX: restore network/address on load
    document.addEventListener('DOMContentLoaded', ()=>{ updateAddress(); renderModeFields(); });
  </script></body>
</html>
